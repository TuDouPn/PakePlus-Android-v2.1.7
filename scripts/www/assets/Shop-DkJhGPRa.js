import{a as e,n as t,o as n,t as r}from"./_plugin-vue_export-helper-dCxJz2px.js";import{n as i,r as a}from"./function-call-CcfrN48q.js";import{n as o,t as s}from"./style-CFVqLaeA.js";import{t as c}from"./style-BtfqK5p_.js";import{B as l,C as u,Ct as d,Et as f,F as p,I as m,N as h,Ot as g,R as _,T as v,Tt as y,V as b,at as x,bt as S,c as C,ct as w,ft as T,g as E,jt as D,kt as O,lt as k,mt as A,rt as j,st as M,tt as N,ut as P,vt as F,w as I,xt as L,z as R}from"./index-D-Puxli-.js";var z=Symbol(),B=()=>T(z,null),[V,H,U]=E(`list`),W=C(P({name:V,props:{error:Boolean,offset:_(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:R(`down`),loadingText:{type:String,default:``},finishedText:String,immediateCheck:b},emits:[`load`,`update:error`,`update:loading`],setup(t,{emit:r,slots:i}){let a=O(t.loading),o=O(),s=O(),c=B(),l=m(o),u=j(()=>t.scroller||l.value),d=()=>{A(()=>{if(a.value||t.finished||t.disabled||t.error||c?.value===!1)return;let{direction:e}=t,n=+t.offset,i=p(u);if(!i.height||I(o))return;let l=!1,d=p(s);l=e===`up`?i.top-d.top<=n:d.bottom-i.bottom<=n,l&&(a.value=!0,r(`update:loading`,!0),r(`load`))})},f=()=>{if(t.finished){let e=i.finished?i.finished():t.finishedText;if(e)return k(`div`,{class:H(`finished-text`)},[e])}},g=()=>{r(`update:error`,!1),d()},_=()=>{if(t.error){let e=i.error?i.error():t.errorText;if(e)return k(`div`,{role:`button`,class:H(`error-text`),tabindex:0,onClick:g},[e])}},v=()=>{if(a.value&&!t.finished&&!t.disabled)return k(`div`,{class:H(`loading`)},[i.loading?i.loading():t.loadingText!=null&&k(e,{class:H(`loading-icon`)},{default:()=>[t.loadingText||U(`loading`)]})])};return y(()=>[t.loading,t.finished,t.error],d),c&&y(c,e=>{e&&d()}),S(()=>{a.value=t.loading}),F(()=>{t.immediateCheck&&d()}),n({check:d}),h(`scroll`,d,{target:u,passive:!0}),()=>{let e=i.default?.call(i),n=k(`div`,{ref:s,class:H(`placeholder`)},null);return k(`div`,{ref:o,role:`feed`,class:H(),"aria-busy":a.value},[t.direction===`down`?e:n,v(),f(),_(),t.direction===`up`?e:n])}}})),[G,K,q]=E(`pull-refresh`),J=50,Y=[`pulling`,`loosing`,`success`],X=C(P({name:G,props:{disabled:Boolean,modelValue:Boolean,headHeight:_(J),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:l,successDuration:_(500),animationDuration:_(300)},emits:[`change`,`refresh`,`update:modelValue`],setup(t,{emit:n,slots:r}){let i,o=O(),s=O(),c=m(o),l=g({status:`normal`,distance:0,duration:0}),d=a(),f=()=>{if(t.headHeight!==J)return{height:`${t.headHeight}px`}},p=()=>l.status!==`loading`&&l.status!==`success`&&!t.disabled,_=e=>{let n=+(t.pullDistance||t.headHeight);return e>n&&(e=e<n*2?n+(e-n)/2:n*1.5+(e-n*2)/4),Math.round(e)},b=(e,r)=>{let i=+(t.pullDistance||t.headHeight);l.distance=e,r?l.status=`loading`:e===0?l.status=`normal`:e<i?l.status=`pulling`:l.status=`loosing`,n(`change`,{status:l.status,distance:e})},x=()=>{let{status:e}=l;return e===`normal`?``:t[`${e}Text`]||q(e)},S=()=>{let{status:t,distance:n}=l;if(r[t])return r[t]({distance:n});let i=[];return Y.includes(t)&&i.push(k(`div`,{class:K(`text`)},[x()])),t===`loading`&&i.push(k(e,{class:K(`loading`)},{default:x})),i},C=()=>{l.status=`success`,setTimeout(()=>{b(0)},+t.successDuration)},w=e=>{i=u(c.value)===0,i&&(l.duration=0,d.start(e))},T=e=>{p()&&w(e)},E=e=>{if(p()){i||w(e);let{deltaY:t}=d;d.move(e),i&&t.value>=0&&d.isVertical()&&(v(e),b(_(t.value)))}},D=()=>{i&&d.deltaY.value&&p()&&(l.duration=+t.animationDuration,l.status===`loosing`?(b(+t.headHeight,!0),n(`update:modelValue`,!0),A(()=>n(`refresh`))):b(0))};return y(()=>t.modelValue,e=>{l.duration=+t.animationDuration,e?b(+t.headHeight,!0):r.success||t.successText?C():b(0,!1)}),h(`touchmove`,E,{target:s}),()=>{let e={transitionDuration:`${l.duration}ms`,transform:l.distance?`translate3d(0,${l.distance}px, 0)`:``};return k(`div`,{ref:o,class:K()},[k(`div`,{ref:s,class:K(`track`),style:e,onTouchstartPassive:T,onTouchend:D,onTouchcancel:D},[k(`div`,{class:K(`head`),style:f()},[S()]),r.default?.call(r)])])}}})),Z={class:`page-container`},Q=r({__name:`Shop`,setup(e){let n=O([]),r=O(!1),a=O(!1),l=O(!1),u=O(1),p=e=>e.mainImage?e.mainImage:e.basisSku&&e.basisSku.productMainImage?e.basisSku.productMainImage:`https://fastly.jsdelivr.net/npm/@vant/assets/ipad.jpeg`,m=async()=>{try{let e=await t.getHotGoods({pageNum:u.value});e&&e.data&&e.data.resultList?(l.value?(n.value=e.data.resultList,l.value=!1):n.value=[...n.value,...e.data.resultList],u.value++,(n.value.length>=e.data.totalCount||e.data.resultList.length===0)&&(a.value=!0)):a.value=!0}catch{i(`获取列表失败`),a.value=!0}finally{r.value=!1}},h=()=>{m()},g=()=>{a.value=!1,r.value=!0,u.value=1,h()};return(e,t)=>{let i=c,u=o,m=s,_=W,v=X;return L(),M(`div`,Z,[k(i,{title:`商品管理 (Weishop)`}),k(v,{modelValue:l.value,"onUpdate:modelValue":t[1]||=e=>l.value=e,onRefresh:g},{default:f(()=>[k(_,{loading:r.value,"onUpdate:loading":t[0]||=e=>r.value=e,finished:a.value,"finished-text":`没有更多了`,onLoad:h},{default:f(()=>[(L(!0),M(N,null,d(n.value,(e,n)=>(L(),x(m,{key:n,num:e.basisSku?.skuSalesVolume||0,price:e.basisSku?.skuSellPrice||`0.00`,desc:`单位: ${e.basisSku?.productUnitName||`件`}`,title:e.productName,thumb:p(e)},{tags:f(()=>[k(u,{plain:``,type:`danger`,style:{"margin-right":`5px`}},{default:f(()=>[...t[2]||=[w(`热销`,-1)]]),_:1}),k(u,{plain:``,type:`primary`},{default:f(()=>[w(D(e.statusText||`正常`),1)]),_:2},1024)]),_:2},1032,[`num`,`price`,`desc`,`title`,`thumb`]))),128))]),_:1},8,[`loading`,`finished`])]),_:1},8,[`modelValue`])])}}},[[`__scopeId`,`data-v-e464a0c4`]]);export{Q as default};