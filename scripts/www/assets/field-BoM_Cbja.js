import{o as e}from"./_plugin-vue_export-helper-dCxJz2px.js";import{n as t,r as n}from"./style-axx0y2Fr.js";import{B as r,D as i,E as a,G as o,H as s,J as c,K as l,N as ee,O as u,Ot as d,P as te,R as f,S as p,St as m,T as h,Tt as g,U as _,X as v,_ as y,c as b,ct as ne,dt as x,g as S,kt as C,lt as w,mt as T,p as re,pt as E,q as D,rt as O,t as k,ut as A,v as j,vt as M,y as ie,z as N}from"./index-D-Puxli-.js";var P=0;function F(){let{name:e=`unknown`}=x()?.type||{};return`${e}-${++P}`}function I(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function ae(e,t){if(I(e)){if(t.required)return!1;if(t.validateEmpty===!1)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}function oe(e,t){return new Promise(n=>{let r=t.validator(e,t);if(c(r)){r.then(n);return}n(r)})}function L(e,t){let{message:n}=t;return l(n)?n(e,t):n||``}function se({target:e}){e.composing=!0}function R({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event(`input`)))}function ce(e,t){let n=p();e.style.height=`auto`;let r=e.scrollHeight;if(D(t)){let{maxHeight:e,minHeight:n}=t;e!==void 0&&(r=Math.min(r,e)),n!==void 0&&(r=Math.max(r,n))}r&&(e.style.height=`${r}px`,i(n))}function z(e,t){return e===`number`&&(e=`text`,t??=`decimal`),e===`digit`&&(e=`tel`,t??=`numeric`),{type:e,inputmode:t}}function B(e){return[...e].length}function V(e,t){return[...e].slice(0,t).join(``)}var[H,U]=S(`field`),W={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:r,max:Number,min:Number,formatter:Function,clearIcon:N(`clear`),modelValue:f(``),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:N(`focus`),formatTrigger:N(`onChange`),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},G=b(A({name:H,props:_({},n,W,{rows:r,type:N(`text`),rules:Array,autosize:[Boolean,Object],labelWidth:r,labelClass:null,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:[`blur`,`focus`,`clear`,`keypress`,`clickInput`,`endValidate`,`startValidate`,`clickLeftIcon`,`clickRightIcon`,`update:modelValue`],setup(n,{emit:r,slots:i}){let s=F(),c=d({status:`unvalidated`,focused:!1,validateMessage:``}),l=C(),f=C(),p=C(),{parent:_}=te(re),b=()=>String(n.modelValue??``),x=e=>{if(o(n[e]))return n[e];if(_&&o(_.props[e]))return _.props[e]},S=O(()=>{let e=x(`readonly`);if(n.clearable&&!e){let e=b()!==``,t=n.clearTrigger===`always`||n.clearTrigger===`focus`&&c.focused;return e&&t}return!1}),D=O(()=>p.value&&i.input?p.value():n.modelValue),A=O(()=>{let e=x(`required`);return e===`auto`?n.rules?.some(e=>e.required):e}),N=e=>e.reduce((e,t)=>e.then(()=>{if(c.status===`failed`)return;let{value:e}=D;if(t.formatter&&(e=t.formatter(e,t)),!ae(e,t)){c.status=`failed`,c.validateMessage=L(e,t);return}if(t.validator)return I(e)&&t.validateEmpty===!1?void 0:oe(e,t).then(n=>{n&&typeof n==`string`?(c.status=`failed`,c.validateMessage=n):n===!1&&(c.status=`failed`,c.validateMessage=L(e,t))})}),Promise.resolve()),P=()=>{c.status=`unvalidated`,c.validateMessage=``},H=()=>r(`endValidate`,{status:c.status,message:c.validateMessage}),W=(e=n.rules)=>new Promise(t=>{P(),e?(r(`startValidate`),N(e).then(()=>{c.status===`failed`?(t({name:n.name,message:c.validateMessage}),H()):(c.status=`passed`,t(),H())})):t()}),G=e=>{if(_&&n.rules){let{validateTrigger:t}=_.props,r=v(t).includes(e),i=n.rules.filter(t=>t.trigger?v(t.trigger).includes(e):r);i.length&&W(i)}},le=e=>{let{maxlength:t}=n;if(o(t)&&B(e)>+t){let n=b();if(n&&B(n)===+t)return n;let r=l.value?.selectionEnd;if(c.focused&&r){let n=[...e],i=n.length-+t;return n.splice(r-i,i),n.join(``)}return V(e,+t)}return e},K=(e,t=`onChange`)=>{let i=e;e=le(e);let a=i.length-e.length;if(n.type===`number`||n.type===`digit`){let r=n.type===`number`;if(e=ie(e,r,r),t===`onBlur`&&e!==``&&(n.min!==void 0||n.max!==void 0)){let t=j(+e,n.min??-1/0,n.max??1/0);+e!==t&&(e=t.toString())}}let s=0;if(n.formatter&&t===n.formatTrigger){let{formatter:t,maxlength:r}=n;if(e=t(e),o(r)&&B(e)>+r&&(e=V(e,+r)),l.value&&c.focused){let{selectionEnd:e}=l.value,n=V(i,e);s=t(n).length-n.length}}if(l.value&&l.value.value!==e)if(c.focused){let{selectionStart:t,selectionEnd:n}=l.value;if(l.value.value=e,o(t)&&o(n)){let r=e.length;a?(t-=a,n-=a):s&&(t+=s,n+=s),l.value.setSelectionRange(Math.min(t,r),Math.min(n,r))}}else l.value.value=e;e!==n.modelValue&&r(`update:modelValue`,e)},ue=e=>{e.target.composing||K(e.target.value)},q=()=>l.value?.blur(),J=()=>l.value?.focus(),Y=()=>{let e=l.value;n.type===`textarea`&&n.autosize&&e&&ce(e,n.autosize)},de=e=>{c.focused=!0,r(`focus`,e),T(Y),x(`readonly`)&&q()},fe=e=>{c.focused=!1,K(b(),`onBlur`),r(`blur`,e),!x(`readonly`)&&(G(`onBlur`),T(Y),a())},X=e=>r(`clickInput`,e),pe=e=>r(`clickLeftIcon`,e),me=e=>r(`clickRightIcon`,e),he=e=>{h(e),r(`update:modelValue`,``),r(`clear`,e)},Z=O(()=>{if(typeof n.error==`boolean`)return n.error;if(_&&_.props.showError&&c.status===`failed`)return!0}),ge=O(()=>{let e=x(`labelWidth`),t=x(`labelAlign`);if(e&&t!==`top`)return{width:y(e)}}),Q=e=>{e.keyCode===13&&(!(_&&_.props.submitOnEnter)&&n.type!==`textarea`&&h(e),n.type===`search`&&q()),r(`keypress`,e)},$=()=>n.id||`${s}-input`,_e=()=>c.status,ve=()=>{let e=U(`control`,[x(`inputAlign`),{error:Z.value,custom:!!i.input,"min-height":n.type===`textarea`&&!n.autosize}]);if(i.input)return w(`div`,{class:e,onClick:X},[i.input()]);let t={id:$(),ref:l,name:n.name,rows:n.rows===void 0?void 0:+n.rows,class:e,disabled:x(`disabled`),readonly:x(`readonly`),autofocus:n.autofocus,placeholder:n.placeholder,autocomplete:n.autocomplete,autocapitalize:n.autocapitalize,autocorrect:n.autocorrect,enterkeyhint:n.enterkeyhint,spellcheck:n.spellcheck,"aria-labelledby":n.label?`${s}-label`:void 0,"data-allow-mismatch":`attribute`,onBlur:fe,onFocus:de,onInput:ue,onClick:X,onChange:R,onKeypress:Q,onCompositionend:R,onCompositionstart:se};return n.type===`textarea`?w(`textarea`,E(t,{inputmode:n.inputmode}),null):w(`input`,E(z(n.type,n.inputmode),t),null)},ye=()=>{let e=i[`left-icon`];if(n.leftIcon||e)return w(`div`,{class:U(`left-icon`),onClick:pe},[e?e():w(k,{name:n.leftIcon,classPrefix:n.iconPrefix},null)])},be=()=>{let e=i[`right-icon`];if(n.rightIcon||e)return w(`div`,{class:U(`right-icon`),onClick:me},[e?e():w(k,{name:n.rightIcon,classPrefix:n.iconPrefix},null)])},xe=()=>{if(n.showWordLimit&&n.maxlength){let e=B(b());return w(`div`,{class:U(`word-limit`)},[w(`span`,{class:U(`word-num`)},[e]),ne(`/`),n.maxlength])}},Se=()=>{if(_&&_.props.showErrorMessage===!1)return;let e=n.errorMessage||c.validateMessage;if(e){let t=i[`error-message`];return w(`div`,{class:U(`error-message`,x(`errorMessageAlign`))},[t?t({message:e}):e])}},Ce=()=>{let e=x(`labelWidth`),t=x(`labelAlign`),r=x(`colon`)?`:`:``;if(i.label)return[i.label(),r];if(n.label)return w(`label`,{id:`${s}-label`,for:i.input?void 0:$(),"data-allow-mismatch":`attribute`,onClick:e=>{h(e),J()},style:t===`top`&&e?{width:y(e)}:void 0},[n.label+r])},we=()=>[w(`div`,{class:U(`body`)},[ve(),S.value&&w(k,{ref:f,name:n.clearIcon,class:U(`clear`)},null),be(),i.button&&w(`div`,{class:U(`button`)},[i.button()])]),xe(),Se()];return e({blur:q,focus:J,validate:W,formValue:D,resetValidation:P,getValidationStatus:_e}),m(u,{customValue:p,resetValidation:P,validateWithTrigger:G}),g(()=>n.modelValue,()=>{K(b()),P(),G(`onChange`),T(Y)}),M(()=>{K(b(),n.formatTrigger),T(Y)}),ee(`touchstart`,he,{target:O(()=>f.value?.$el)}),()=>{let e=x(`disabled`),r=x(`labelAlign`),a=ye(),o=()=>{let e=Ce();return r===`top`?[a,e].filter(Boolean):e||[]};return w(t,{size:n.size,class:U({error:Z.value,disabled:e,[`label-${r}`]:r}),center:n.center,border:n.border,isLink:n.isLink,clickable:n.clickable,titleStyle:ge.value,valueClass:U(`value`),titleClass:[U(`label`,[r,{required:A.value}]),n.labelClass],arrowDirection:n.arrowDirection},{icon:a&&r!==`top`?()=>a:null,title:o,value:we,extra:i.extra})}}}));export{W as n,F as r,G as t};